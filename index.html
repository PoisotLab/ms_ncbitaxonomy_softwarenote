<!DOCTYPE html>
<html lang="" dir="ltr">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>NCBITaxonomy.jl - rapid biological names finding and
reconciliation</title>
    <script src="https://hypothes.is/embed.js" async></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css"
        integrity="sha256-l85OmPOjvil/SOvVt3HnSSjzF1TUMyT9eV0c2BzEGzU=" crossorigin="anonymous" />
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,300;0,400;0,500;1,300;1,400;1,500&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Roboto+Condensed:ital,wght@0,300;0,400;0,700;1,300;1,400;1,700&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Roboto+Mono:ital,wght@0,400;0,500;1,400;1,500&display=swap');

        :root {
            --citation: #1976D2;
            --structure: hsl(210, 61%, 43%);

            --light: #474747;
            --pale: #a5a5a5;
            --grey: #e0e0e0;
            --nav: #fdfdfd;

            --width: 820px;
            --inner-space: 1.2em;
        }

        html {
            background-color: white;
        }

        body {
            font-family: "Roboto", sans-serif;
            margin: 0 0;
            padding: 0 0;
        }

        article>p {
            line-height: 135%;
        }

        article>h1 {
            padding-top: 3em;
        }

        a {
            text-decoration: none;
            color: #000;
            border-bottom: 1px solid var(--structure);
        }

        a:hover {
            font-weight: 500;
        }

        .citation {
            color: var(--citation);
        }

        .container {
            margin: 0em auto;
            max-width: var(--width);
            padding: var(--inner-space);
        }

        header>.container {
            margin-top: 4em;
        }

        code,
        pre {
            font-family: "Roboto Mono", monospace;
        }

        pre {
            white-space: pre-wrap;
        }

        h1,
        h2,
        h3 {
            color: var(--structure);
            font-family: "Roboto Condensed", sans-serif;
            font-weight: 400;
        }

        header {
            font-family: "Roboto Condensed", sans-serif;
            z-index: 5;
            color: black;
            margin-top: 4rem;
        }

        .header--title {
            font-weight: 400;
            font-size: 2rem;
            margin-bottom: 1rem;
        }

        .header--authors>span {
            color: var(--light);
            font-weight: 400;
        }

        main {
            padding-top: 8em !important;
            padding-bottom: 8em !important;
        }

        footer {
            background-color: var(--grey);
            font-weight: 300;
        }

        .abstract {
            color: var(--light);
            margin-bottom: 5em;
        }

        figure {
            max-width: 100%;
            border: 1px solid var(--pale);
            border-radius: 2px;
            margin: 1em 0.5em;
        }

        figure>img {
            max-width: 100%;
            display: block;
            margin: 0em auto;
        }

        figure>figcaption {
            padding: var(--inner-space);
        }

        table {
            width: 100%;
            min-width: 100%;
            border-collapse: collapse;
        }

        table>caption {
            padding: var(--inner-space);
        }

        figcaption,
        caption {
            color: var(--light);
            font-weight: 300;
        }

        thead {
            color: var(--structure);
        }

        td,
        th {
            padding: 3px;
        }

        tr {
            border-top: 1px solid var(--structure);
            border-bottom: 1px solid var(--structure);
        }

        tbody>tr:nth-child(even) {
            background: var(--grey)
        }

        ;

        tbody {
            border-bottom: 1px solid var(--structure);
        }

        #refs {
            font-size: 90%;
            column-count: 2;
        }

        #refs>.csl-entry {
            padding-bottom: 0.2em;
            padding-top: 0.2em;
        }

        .hanging-indent>.csl-entry {
            padding-left: 15px;
            text-indent: -15px;
        }

        .artifacts {
            text-align: center;
            border-radius: 4px;
            background-color: var(--grey);
            padding: 1em;
            margin-top: 4em;
        }

        .artifacts a{
            background-color: var(--structure);
            text-decoration: none;
            margin: 0px 2em;
            color: white;
            text-transform: capitalize;
            border-radius: 4px;
            text-align: center;
            padding: 4px 4px;
            width: 7em;
            display: inline-block;
        }    </style>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css"
        integrity="sha384-vKruj+a13U8yHIkAyGgK1J3ArTLzrFGBbBc0tDp4ad/EyewESeXE/Iv67Aj8gKZ0" crossorigin="anonymous">
    
    
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.js"
        integrity="sha384-PwRUT/YqbnEjkZO0zZxNqcxACrXe+j766U2amXcgMg5457rve2Y7I6ZJSm2A0mS4"
        crossorigin="anonymous"></script>
    
    
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/contrib/auto-render.min.js"
        integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05" crossorigin="anonymous"
        onload="renderMathInElement(document.body);"></script>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            renderMathInElement(document.body, {
                delimiters: [
                    { left: "$$", right: "$$", display: true },
                    { left: "$", right: "$", display: false }
                ]
            });
        });
    </script>
</head>

<body>
    <header>
        <div class="container">
            <div class="header--title">NCBITaxonomy.jl - rapid
biological names finding and reconciliation</div>
            <div class="header--authors">
                <span class="header--author">
                <a href="https://orcid.org/0000-0002-0735-5184" target="_blank">
                    Timothée Poisot
                </a>
                <sup class="affiliation">1,2</sup>
                </span><span class="header--author">
                <a href="https://orcid.org/0000-0002-0965-1649" target="_blank">
                    Rory Gibb
                </a>
                <sup class="affiliation">3,4,5</sup>
                </span><span class="header--author">
                <a href="https://orcid.org/0000-0002-4308-6321" target="_blank">
                    Sadie J. Ryan
                </a>
                <sup class="affiliation">6,7,8</sup>
                </span><span class="header--author">
                <a href="https://orcid.org/0000-0001-6960-8434" target="_blank">
                    Colin J. Carlson
                </a>
                <sup class="affiliation">10,9</sup>
                </span>
            </div>
        </div>
    </header>

    <main class="container">
        <section class="abstract">
            <code>NCBITaxonomy.jl</code> is a package designed to
            facilitate the reconciliation and cleaning of taxonomic
            names, using a local copy of the NCBI taxonomic backbone
            <span class="citation"
            data-cites="Federhen2012NcbTax Schoch2020NcbTax">(Federhen
            2012, Schoch et al. 2020)</span>; The basic search functions
            are coupled with quality-of-life functions including
            case-insensitive search and custom fuzzy string matching to
            facilitate the amount of information that can be extracted
            automatically while allowing efficient manual curation and
            inspection of results. <code>NCBITaxonomy.jl</code> works
            with version 1.6 of the Julia programming language <span
            class="citation" data-cites="Bezanson2017JulFre">(Bezanson
            et al. 2017)</span>, and relies on the Apache Arrow format
            to store a local copy of the NCBI raw taxonomy files. The
            design of <code>NCBITaxonomy.jl</code> has been inspired by
            similar efforts, like the R package <code>taxadb</code>
            <span class="citation" data-cites="Norman2020TaxHig">(Norman
            et al. 2020)</span>, which provides an offline alternative
            to packages like <code>taxize</code> <span class="citation"
            data-cites="Chamberlain2013TaxTax">(Chamberlain and Szöcs
            2013)</span>.


            <div class="artifacts">
                <a href="Poisot_et_al_2023_ncbitaxonomyjl__draft.pdf" title="Draft" target="_blank">Draft</a>
                <a href="Poisot_et_al_2023_ncbitaxonomyjl__preprint.pdf" title="Preprint" target="_blank">Preprint</a>
                <a href="Poisot_et_al_2023_ncbitaxonomyjl_.odt" title="OpenDocument" target="_blank">Libre Office</a>
            </div>
        </section>

        <article>
            <p>Unambiguously identifying species is a far more
            challenging task than it may appear. There are a vast number
            of reasons for this. Different databases keep different
            taxonomic “backbones”, <em>i.e.</em> different data
            structures in which names are mapped to species, and
            organised in a hierarchy. Not all names are unique
            identifiers to groups. For example, <em>Io</em> can either
            refer to a genus of plants from the aster family, or to a
            genus of molluscs; the genus <em>Mus</em> (of which the
            house mouse <em>Mus musculus</em> is a species), contains a
            sub-genus <em>also</em> named <em>Mus</em> (within which
            <em>Mus musculus</em> is located). Conversely, the same
            species can have several names, which are valid synonyms:
            for example, the domestic cow <em>Bos taurus</em> admits
            <em>Bos primigenius taurus</em> as a valid synonym. In
            addition to binomial names, the same species can be known by
            many vernacular (common) names, which are language or even
            region-specific: <em>Ovis aries</em>, for example, has valid
            English vernaculars including lamb, sheep, wild sheep, and
            domestic sheep.</p>
            <p>In addition, taxonomic nomenclature changes regularly,
            with groups being split, merged, or moved to a new position
            in the tree of life; often, taxonomic revisions lead to
            these events occuring simultaneously. This is, notably, a
            common occurrence with viral taxonomy, each subsequent
            version of which can differ markedly from the last; compare,
            <em>e.g</em> <span class="citation"
            data-cites="Lefkowitz2018VirTax">Lefkowitz et al.
            (2018)</span> to <span class="citation"
            data-cites="Walker2020ChaVir">Walker et al. (2020)</span>,
            where entire viral sub-trees were split, re-organized, and
            created within just two years. As a consequence any mapping
            of names to other biological entities can become outdated,
            and therefore invalid. These taxonomic changes have profound
            implications for the way we perceive biodiversity at global
            scales <span class="citation"
            data-cites="Dikow2009BioRes">(Dikow et al. 2009)</span>, to
            the point were taxonomic revisions should sometimes be
            actively conducted to improve <em>e.g.</em> conservation
            outcomes <span class="citation"
            data-cites="Melville2021RetApp">(Melville et al.
            2021)</span>.</p>
            <p>None of these issues, were they to happen in isolation,
            would be very difficult to deal with. Indeed, performing the
            lookup for any text string in any database is a trivial
            operation. But to add to the complexity, one must also
            consider that most taxa names are at some point manually
            typed, which has the potential to introduce additional
            sources of variation in raw data; it is likely to expect
            that such mistakes may arise when attempting to write down
            the (perfectly valid) names of the bacterial isolate known
            as <em>Myxococcus
            llanfairpwllgwyngyllgogerychwyrndrobwllllantysiliogogogochensis</em>,
            or of the crowned slaty flycatcher <em>Griseotyrannus
            aurantioatrocristatus</em>. These mistakes are more likely
            when dealing with hyper-diverse samples (demanding to
            memorize more names), like plant census <span
            class="citation"
            data-cites="Dauncey2016ComMis Wagner2016RevSof Conti2021MatAlg">(Dauncey
            et al. 2016, Wagner 2016, Conti et al. 2021)</span>; when
            dealing with multiple investigators with different knowledge
            of the taxonomy; and as a result of the estimated error in
            any data entry exercice, which other fields estimate at up
            to about 5% <span class="citation"
            data-cites="Barchard2011PreHum">(Barchard and Pace
            2011)</span>. As a result, the first question one needs to
            ask when confronted with a string of character that
            purportedly points to a node in the tree of life is not “to
            which entry in the taxonomy database is it associated?”, but
            “is there a mistake in this name that is likely to render a
            simple lookup invalid?”.</p>
            <p>All these considerations become important when matching
            species names both within and across datasets. Let us
            consider the hypothetical species survey of riverine fishes:
            European chub, <em>Cyprinus cephalus</em>, <em>Leuciscus
            cephalus</em>, <em>Squalius cephalus</em>. All are the same
            species (<em>S. cephalus</em>), referred to as one of the
            vernacular (European chub) and two formerly accepted names
            now classified as synonyms (but still present in the
            litterature). A simple estimate of diversity based on the
            user-supplied names would give <span
            class="math inline"><em>n</em> = 4</span> species, when
            there is in fact only one. Some cases can be more difficult
            to catch; for example, the species <em>Isoetes minima</em>
            is frequently mentionned as <em>Isœtes minima</em>, because
            text processing use the “œ” grapheme to mark the “oe”
            diphthong. When the size of biodiversity datasets increases,
            and notably when the taxonomic scope of these datasets
            explodes, including organisms for which “names” are a
            fuzzier concept (for example, <em>Influenza A virus
            (A/Sydney/05/97-like(H3N2))</em> is a valid name for a
            common influenza strain, although one that lacks a taxonomic
            rank), the feasibility of manual curation decreases.</p>
            <p>In this manuscript, we describe
            <code>NCBITaxonomy.jl</code>, a Julia package that provides
            advanced name matching and error handling capacities for the
            reconciliation of taxonomic names to the NCBI database. This
            package was used to facilitate the development of the
            <em>CLOVER</em> <span class="citation"
            data-cites="Gibb2021DatPro">(Gibb et al. 2021)</span>
            database of host-virus associations, by reconciling the
            names of viruses and mammals from four different sources,
            where all of the issues described above were present. More
            recently, it has become part of the automated curation of
            data for the <em>VIRION</em> <span class="citation"
            data-cites="Carlson2022GloVir">(Carlson et al. 2022)</span>
            database, which automatically curates an up-to-date,
            authoritative virome network from dozens of heterogeneous
            sources. We describe the core capacities of this package,
            and highlight how it enables safe, high-performance name
            reconciliation.</p>
            <h1
            id="design-principles-and-comparison-to-other-tools">Design
            principles and comparison to other tools</h1>
            <p>Based on the author’s experience reconciling lists of
            thousands of biological names, <code>NCBITaxonomy.jl</code>
            is built around a series of features that allow (i) maximum
            flexibility when handling names without a direct match, (ii)
            a bespoke exception system to handle failures to match
            automatically, and (ii) limits to the pool of potential
            names in order to achieve orders-of-magnitude speedups when
            the broad classification of the name to match is known.
            Adhering to these design principles led to a number of
            choices. A comparison of the features of different packages,
            as infered from their public documentation, is presented in
            tbl. <strong>¿tbl:comparison?</strong>.</p>
            <p>First, we specifically target programmatic (as opposed to
            command-line) based approaches, so that the functionalities
            of the package can be accessed as part of a larger pipeline.
            Second, to speed up the queries, we work from a local
            version of the database, the installation of which is
            handled at build time by the package itself; each project
            using the package can use its own version of the taxonomy by
            specifying a folder where it is stored through an
            environmental variable. Third, because we <em>cannot</em>
            trust that the names as presented in the original data are
            correct, we offer case-insensitive search (at no time cost)
            and fuzzy-matching (at a significant time cost). Either of
            these strategies can be called only after a case-sensitive,
            non-fuzzy search yields an exception about the lack of a
            direct match. Finally, in order to achieve a good
            performance even when relying on fuzzy matching, we offer
            the ability to limit the search to specific parts of the
            taxonomy database. An example of the impact of this feature
            on the performance of the package is presented below.</p>
            <table style="width:100%;">
            <caption>Comparison of core features of packages offering
            access to the NCBI taxonomic backbone. “Library”: ability to
            be called from code. “CLI”: ability to work as a
            command-line tool. “Local DB”: ability to store a copy of
            the database locally. “Fuzzy”: ability to perform fuzzy
            matching on inputs. “Case”: ability to perform
            case-insensitive search. “Subsets”: ability to limit the
            search to a subset of the raw database. “Ranks”: ability to
            limit the search to specific raxonomi ranks. The features of
            the various packages have been determined from reading their
            documentation. {tbl. <strong>¿tbl:id?</strong>}</caption>
            <colgroup>
            <col style="width: 22%" />
            <col style="width: 10%" />
            <col style="width: 9%" />
            <col style="width: 6%" />
            <col style="width: 10%" />
            <col style="width: 6%" />
            <col style="width: 6%" />
            <col style="width: 9%" />
            <col style="width: 6%" />
            <col style="width: 11%" />
            </colgroup>
            <thead>
            <tr class="header">
            <th>Tool</th>
            <th>Lang.</th>
            <th style="text-align: center;">Library</th>
            <th style="text-align: center;">CLI</th>
            <th style="text-align: center;">Local DB</th>
            <th style="text-align: center;">Fuzzy</th>
            <th style="text-align: center;">Case</th>
            <th style="text-align: center;">Subsets</th>
            <th style="text-align: center;">Ranks</th>
            <th>Reference</th>
            </tr>
            </thead>
            <tbody>
            <tr class="odd">
            <td><code>NCBITaxonomy.jl</code></td>
            <td><code>Julia</code></td>
            <td style="text-align: center;">+</td>
            <td style="text-align: center;"></td>
            <td style="text-align: center;">+</td>
            <td style="text-align: center;">+</td>
            <td style="text-align: center;">+</td>
            <td style="text-align: center;">+</td>
            <td style="text-align: center;">+</td>
            <td></td>
            </tr>
            <tr class="even">
            <td><code>taxadb</code></td>
            <td><code>R</code></td>
            <td style="text-align: center;">+</td>
            <td style="text-align: center;"></td>
            <td style="text-align: center;">+</td>
            <td style="text-align: center;"></td>
            <td style="text-align: center;"></td>
            <td style="text-align: center;">+</td>
            <td style="text-align: center;">+</td>
            <td></td>
            </tr>
            <tr class="odd">
            <td><code>taxopy</code></td>
            <td><code>Python</code></td>
            <td style="text-align: center;">+</td>
            <td style="text-align: center;"></td>
            <td style="text-align: center;">+</td>
            <td style="text-align: center;"></td>
            <td style="text-align: center;">+</td>
            <td style="text-align: center;"></td>
            <td style="text-align: center;"></td>
            <td></td>
            </tr>
            <tr class="even">
            <td><code>rentrez</code></td>
            <td><code>R</code></td>
            <td style="text-align: center;">+</td>
            <td style="text-align: center;"></td>
            <td style="text-align: center;"></td>
            <td style="text-align: center;"></td>
            <td style="text-align: center;"></td>
            <td style="text-align: center;"></td>
            <td style="text-align: center;">+</td>
            <td></td>
            </tr>
            <tr class="odd">
            <td><code>Taxonkit</code></td>
            <td><code>Python</code></td>
            <td style="text-align: center;"></td>
            <td style="text-align: center;">+</td>
            <td style="text-align: center;">+</td>
            <td style="text-align: center;"></td>
            <td style="text-align: center;"></td>
            <td style="text-align: center;"></td>
            <td style="text-align: center;"></td>
            <td></td>
            </tr>
            <tr class="even">
            <td><code>NCBI-taxonomist</code></td>
            <td><code>Python</code></td>
            <td style="text-align: center;"></td>
            <td style="text-align: center;">+</td>
            <td style="text-align: center;">+</td>
            <td style="text-align: center;"></td>
            <td style="text-align: center;"></td>
            <td style="text-align: center;"></td>
            <td style="text-align: center;"></td>
            <td></td>
            </tr>
            </tbody>
            </table>
            <h1 id="overview-of-functionalities">Overview of
            functionalities</h1>
            <p>An up-to-date version of the documentation for
            <code>NCBITaxonomy.jl</code> can be found in the package’s
            <em>GitHub</em> repository (<a
            href="https://github.com/PoisotLab/NCBITaxonomy.jl">PoisotLab/NCBITaxonomy.jl</a>),
            including examples and in-line documentation of every
            method. The package is released under the MIT license.
            Contributions can be made in the form of issues (bug
            reports, questions, features suggestions) and pull requests,
            all of which can be consulted publicly. Alternatively, the
            package can be downloaded from its Zenodo page (ID <a
            href="https://zenodo.org/record/"><code>5825828</code></a>),
            along with a versioned DOI.</p>
            <h2 id="local-file-storage">Local file storage</h2>
            <p>In order to achieve good performance, the package will
            first retrieve the latest (as validated by its checksum)
            NCBI taxonomy backbone, store it locally, and pre-process it
            as a set of Julia data tables. By default, the taxonomy will
            be downloaded to the user’s home directory, which is not an
            ideal solution, and therefore we recommend that users set an
            environment variable to specificy where the data will be
            loaded from (this path will be created if it doesn’t
            exist):</p>
            <div class="sourceCode" id="cb1"><pre
            class="sourceCode julia"><code class="sourceCode julia"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="cn">ENV</span>[<span class="st">&quot;NCBITAXONOMY_PATH&quot;</span>] <span class="op">=</span> <span class="fu">joinpath</span>(<span class="fu">homedir</span>(), <span class="st">&quot;data&quot;</span>, <span class="st">&quot;NCBITaxonomy.jl&quot;</span>)</span></code></pre></div>
            <p>Note that this location can be different for different
            projects, as the package is able to update the taxonomic
            backbone (and will indeed prompt the user to do so if the
            taxonomy is more than 90 days old, as infered from looking
            at the raw files creation timestamp). The package can then
            be checked out and installed anonymously from the central
            Julia repository:</p>
            <div class="sourceCode" id="cb2"><pre
            class="sourceCode julia"><code class="sourceCode julia"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Pkg</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="bu">Pkg</span>.<span class="fu">add</span>(<span class="st">&quot;NCBITaxonomy&quot;</span>)</span></code></pre></div>
            <p>As long as the package is not re-built, the local set of
            tables downloaded from NCBI will not change; this way, users
            can re-run an analysis with a guarantee that the underlying
            taxonomic backbone has not changed, which is not the case
            when relying on API queries. In order to update the
            taxonomic backbone, users can call the <code>build</code>
            function of Julia’s package manager
            (<code>]build NCBITaxonomy</code>), which will download the
            most recent version of all files.</p>
            <p>This software note describes version <code>v0.3.0</code>
            of the package (we follow semantic versioning), which works
            on Julia 1.5 upwards. The dependencies are all resolved by
            the package manager at installation, and (on the user-facing
            side) include the <code>StringDistances.jl</code> package,
            allowing users to experiment with different string matching
            methods. As is best practices for Julia packages, a
            <code>Project.toml</code> file specifying compatible
            dependencies versions is distributed with the package. The
            code is covered by unit-tests (with about 98% coverage), as
            well as integration tests as part of the documentation
            (specifically, a use-case detailing how to clean data from a
            biodiversity survey, and a use-case aiming to reconstruct a
            taxonomic tree for the Lemuriformes).</p>
            <h2 id="improved-name-matching">Improved name matching</h2>
            <p>Name finding, <em>i.e.</em> the matching of an arbitrary
            string to a taxonomic identifier, is primarily done through
            the <code>taxon</code> function, which admits either a
            unique NCBI identifier (<em>e.g.</em>
            <code>taxon(36219)</code> for the bogue <em>Boops
            boops</em>), a string (<code>taxon("Boops boops")</code>),
            or a data frame with a restricted list of names in order to
            create a name finder function (see the next section). The
            <code>taxon</code> method has additional arguments to
            perform fuzzy matching in order to catch possible typos
            (<code>taxon("Boops bops"; strict=false)</code>), to perform
            a lowercase search (useful when alphanumeric codes are part
            of the taxon name, like for some viruses), and to restrict
            the the search to a specific taxonomic rank. The
            <code>taxon</code> function also accepts a
            <code>preferscientificname</code> keyword, to prevent
            matching vernacular names; the use of this keyword ought to
            be informed by knowledge about how the data were
            entered.</p>
            <p>The lowercase search can be a preferable alternative to
            fuzzy string matching. Consider the string
            <code>Adeno-associated virus 3b</code> - it has three names
            with equal distance (under the Levensthein string distance
            function):</p>
            <div class="sourceCode" id="cb3"><pre
            class="sourceCode julia"><code class="sourceCode julia"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>julia<span class="op">&gt;</span> <span class="fu">similarnames</span>(<span class="st">&quot;Adeno-associated virus 3b&quot;</span>; threshold<span class="op">=</span><span class="fl">0.95</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fl">3</span><span class="op">-</span>element <span class="dt">Vector</span>{<span class="dt">Pair</span>{NCBITaxon, <span class="dt">Float64</span>}}<span class="op">:</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  Adeno<span class="op">-</span>associated virus <span class="op">-</span> <span class="fl">3</span> (ncbi<span class="op">:</span><span class="fl">46350</span>) <span class="op">=&gt;</span> <span class="fl">0.96</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>   Adeno<span class="op">-</span>associated virus <span class="fl">3</span>B (ncbi<span class="op">:</span><span class="fl">68742</span>) <span class="op">=&gt;</span> <span class="fl">0.96</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a> Adeno<span class="op">-</span>associated virus <span class="fl">3</span>A (ncbi<span class="op">:</span><span class="fl">1406223</span>) <span class="op">=&gt;</span> <span class="fl">0.96</span></span></code></pre></div>
            <p>Depending on the operating system (and specifically
            whether it is case-sensitive), either of these three names
            can be returned; compare to the output of a case insensitive
            name search:</p>
            <div class="sourceCode" id="cb4"><pre
            class="sourceCode julia"><code class="sourceCode julia"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>julia<span class="op">&gt;</span> <span class="fu">taxon</span>(<span class="st">&quot;Adeno-associated virus 3b&quot;</span>; casesensitive<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>Adeno<span class="op">-</span>associated virus <span class="fl">3</span>B (ncbi<span class="op">:</span><span class="fl">68742</span>)</span></code></pre></div>
            <p>This returns the correct name.</p>
            <h2 id="name-matching-output-and-error-handling">Name
            matching output and error handling</h2>
            <p>When it succeeds, <code>taxon</code> will return a
            <code>NCBITaxon</code> object (made of a <code>name</code>
            string field, and an <code>id</code> numerical field). That
            being said, the package is designed under the assumption
            that ambiguities should yield an error for the user to
            handle. There are two such errors:
            <code>NameHasNoDirectMatch</code> (with instructions about
            how to possible solve it, using the
            <code>similarnames</code> function), or a
            <code>NameHasMultipleMatches</code> (listing the possible
            valid matches, and suggesting to use
            <code>alternativetaxa</code> to find the correct one).
            Therefore, the common way to work with the
            <code>taxon</code> function would be to wrap it in a
            <code>try</code>/<code>catch</code> statement:</p>
            <div class="sourceCode" id="cb5"><pre
            class="sourceCode julia"><code class="sourceCode julia"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>try</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">taxon</span>(name)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Additional operations with the matched name</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>catch err</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="fu">isa</span>(err, NameHasNoDirectMatch)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># What to do if no match is found</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">elseif</span> <span class="fu">isa</span>(err, NameHasMultipleMatches)</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># What to do if there are multiple matches</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># What to do in case of another error that is not NCBITaxonomy specific</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">end</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>
            <p>These functions will not demand any user input in the
            form of key presses (though they can be wrapped in
            additional code to allow it), as they are intended to run on
            clusters or virtual machines without supervision. The
            <code>taxon</code> function has good scaling using muliple
            threads. For convenience in rapidly getting a taxon for
            demonstration purposes, we also provide a string macro,
            whereby <em>e.g.</em> <code>ncbi"Procyon lotor"</code> will
            return the taxon object for the raccoon.</p>
            <h2 id="name-filtering-functions">Name filtering
            functions</h2>
            <p>As the full NCBI names table has over 3 million entries
            at the time of writing, we have provided a number of
            functions to restrict the scope of names that are searched.
            These are driven by the NCBI <em>divisions</em>. For example
            <code>nf = mammalfilter(true)</code> will return a data
            frame containing the names of mammals, inclusive of rodents
            and primates, and can be used with <em>e.g.</em>
            <code>taxon(nf, "Pan")</code>. This has the dual advantage
            of making search faster, but also of avoiding matching on
            names that are shared by another taxonomic group (which is
            not an issue with <em>Pan</em>, but is an issue with
            <em>e.g.</em> <em>Io</em> as mentioned in the introduction,
            or with the common name <em>Lizard</em>, which fuzzy-matches
            on the hemipteran genus <em>Lisarda</em> rather than the
            class <em>Lepidosauria</em>).</p>
            <p>Note that the use of a restricted list of names can have
            significant performance consequences: compare, for example,
            the time taken to return the taxon <em>Pan</em> in the
            entire database, in all mammals, and in all primates:</p>
            <table>
            <colgroup>
            <col style="width: 28%" />
            <col style="width: 20%" />
            <col style="width: 12%" />
            <col style="width: 15%" />
            <col style="width: 22%" />
            </colgroup>
            <thead>
            <tr class="header">
            <th>Names list</th>
            <th style="text-align: center;">Fuzzy matching</th>
            <th>Time (ms)</th>
            <th>Allocations</th>
            <th>Memory allocated</th>
            </tr>
            </thead>
            <tbody>
            <tr class="odd">
            <td>all</td>
            <td style="text-align: center;">no</td>
            <td>23</td>
            <td>34</td>
            <td>2 KiB</td>
            </tr>
            <tr class="even">
            <td></td>
            <td style="text-align: center;">yes</td>
            <td>105</td>
            <td>2580</td>
            <td>25 MiB</td>
            </tr>
            <tr class="odd">
            <td><code>mammalfilter(true)</code></td>
            <td style="text-align: center;">no</td>
            <td>0.55</td>
            <td>32</td>
            <td>2 KiB</td>
            </tr>
            <tr class="even">
            <td></td>
            <td style="text-align: center;">yes</td>
            <td>1.9</td>
            <td>551</td>
            <td>286 KiB</td>
            </tr>
            <tr class="odd">
            <td><code>primatefilter()</code></td>
            <td style="text-align: center;">no</td>
            <td>0.15</td>
            <td>33</td>
            <td>2 KiB</td>
            </tr>
            <tr class="even">
            <td></td>
            <td style="text-align: center;">yes</td>
            <td>0.3</td>
            <td>92</td>
            <td>27 KiB</td>
            </tr>
            </tbody>
            </table>
            <p>Clearly, the optimal search strategy is to (i) rely on
            name filters to ensure that search are conducted within the
            appropriate NCBI division, and (ii) only rely on fuzzy
            matching when the strict or lowercase match fails to return
            a name, as fuzzy matching can result in order of magnitude
            more run time and memory footprint. These numbers were
            obtained on a single Intel i7-8665U CPU (@ (1.90GHz). Using
            <code>"chimpanzees"</code> as the search string (one of the
            NCBI recognized vernaculars for <em>Pan</em>) gave
            qualitatively similar results, suggesting that there is no
            performance cost associated with working with synonyms or
            verncular input data.</p>
            <h2 id="quality-of-life-functions">Quality of life
            functions</h2>
            <p>In order to facilitate working with names, we provide the
            <code>authority</code> function (gives the full taxonomic
            authority for a name), <code>synonyms</code> (to get
            alternative valid names), <code>vernacular</code> (for
            English common names), and <code>rank</code> (for the
            taxonomic rank). These functions are not used in name
            matching, but are often useful in the post-processing of
            results.</p>
            <h2 id="taxonomic-lineages-navigation">Taxonomic lineages
            navigation</h2>
            <p>The <code>children</code> function will return all nodes
            that are directly descended from a taxon; the
            <code>descendants</code> function will recursively apply
            this function to all descendants of these nodes, until only
            terminal leaves are reached. The <code>parent</code>
            function is an “upwards” equivalent, giving the taxon from
            which a taxon descends; the <code>lineage</code> function
            chains calls to <code>parent</code> until either
            <code>taxon(1)</code> (the taxonomy root) or an arbitrary
            ancestor is reached.</p>
            <p>The <code>taxonomicdistance</code> function (and its
            in-place equivalent, <code>taxonomicdistance!</code>, which
            uses memory-efficient re-allocation if the user needs to
            change the distance between taxonomic ranks) uses the <span
            class="citation" data-cites="Shimatani2001MeaSpe">Shimatani
            (2001)</span> approach to reconstruct a matrix of distances
            based on taxonomy, which can serve as a rough proxy when no
            phylogenies are available. This allows coarse estimations of
            taxonomic diversity based on species lists. The default
            distance between taxonomic levels is as in <span
            class="citation" data-cites="Shimatani2001MeaSpe">Shimatani
            (2001)</span> (<em>i.e.</em> species have a distance of 0,
            genus of 1, family of 2, sub-classes of 3, and everything
            else 4), but specific scores can be passed for <em>any</em>
            taxonomic level know to the NCBI name table.</p>
            <h1 id="conclusion">Conclusion</h1>
            <p><code>NCBITaxonomy.jl</code> enables rapid,
            taxonomically-restricted, adaptive matching for taxonomic
            names. By implementing various combinations of search
            strategies, it allows users to (i) optimize the speed of
            their queries and (ii) avoid usual caveats of simple string
            matching. Through explicit exceptions, it allows to write
            code that will handle the possible edge cases that cannot be
            solved automatically in a way that does not interrupt
            execution, or requires manual input by the user. Given the
            breadth of the NCBI taxonomy database,
            <code>NCBITaxonomy.jl</code> is particularly suited to the
            name cleaning of large datasets of names.</p>
            <p><strong>Acknowledgements:</strong> This work was
            supported by funding to the Viral Emergence Research
            Initiative (VERENA) consortium including NSF BII 2021909 and
            2213854 and a grant from Institut de Valorisation des
            Données (IVADO), by the NSERC Discovery Grants and Discovery
            Acceleration Supplement programs, and by a donation from the
            Courtois Foundation. Benchmarking of this package on
            distributed systems was enabled by support provided by
            Calcul Québec (<code>www.calculquebec.ca</code>) and Compute
            Canada (<code>www.computecanada.ca</code>). TP wrote the
            initial code, TP and CJC contributed to API design, and all
            authors contributed to functionalities and usability
            testing.</p>
            <h1 class="unnumbered" id="references">References</h1>
            <div id="refs"
            class="references csl-bib-body hanging-indent"
            role="doc-bibliography">
            <div id="ref-Barchard2011PreHum" class="csl-entry"
            role="doc-biblioentry">
            Barchard, K. and Pace, L. 2011. <a
            href="https://doi.org/10.1016/j.chb.2011.04.004">Preventing
            human error: The impact of data entry methods on data
            accuracy and statistical results</a>. - Computers in Human
            Behavior 27: 1834–1839.
            </div>
            <div id="ref-Bezanson2017JulFre" class="csl-entry"
            role="doc-biblioentry">
            Bezanson, J. et al. 2017. <a
            href="https://doi.org/10.1137/141000671">Julia: A Fresh
            Approach to Numerical Computing</a>. - SIAM Review 59:
            65–98.
            </div>
            <div id="ref-Carlson2022GloVir" class="csl-entry"
            role="doc-biblioentry">
            Carlson, C. J. et al. 2022. <a
            href="https://doi.org/10.1128/mbio.02985-21">The Global
            Virome in One Network (VIRION): An Atlas of Vertebrate-Virus
            Associations</a>. - mBio in press.
            </div>
            <div id="ref-Chamberlain2013TaxTax" class="csl-entry"
            role="doc-biblioentry">
            Chamberlain, S. A. and Szöcs, E. 2013. <a
            href="https://doi.org/10.12688/f1000research.2-191.v2">Taxize:
            Taxonomic search and retrieval in R</a>. - F1000Research 2:
            191.
            </div>
            <div id="ref-Conti2021MatAlg" class="csl-entry"
            role="doc-biblioentry">
            Conti, M. et al. 2021. Match Algorithms for Scientific Names
            in FlorItaly, the Portal to the Flora of Italy. - Plants 10:
            974.
            </div>
            <div id="ref-Dauncey2016ComMis" class="csl-entry"
            role="doc-biblioentry">
            Dauncey, E. A. et al. 2016. Common mistakes when using plant
            names and how to avoid them. - European Journal of
            Integrative Medicine 8: 597–601.
            </div>
            <div id="ref-Dikow2009BioRes" class="csl-entry"
            role="doc-biblioentry">
            Dikow, T. et al. 2009. Biodiversity Research Based on
            Taxonomic Revisions - A Tale of Unrealized Opportunities. -
            In: Diptera Diversity: Status, Challenges and Tools. Brill,
            pp. 323–346.
            </div>
            <div id="ref-Federhen2012NcbTax" class="csl-entry"
            role="doc-biblioentry">
            Federhen, S. 2012. The NCBI taxonomy database. - Nucleic
            acids research 40: D136–D143.
            </div>
            <div id="ref-Gibb2021DatPro" class="csl-entry"
            role="doc-biblioentry">
            Gibb, R. et al. 2021. <a
            href="https://doi.org/10.1093/biosci/biab080">Data
            Proliferation, Reconciliation, and Synthesis in Viral
            Ecology</a>. - BioScience in press.
            </div>
            <div id="ref-Lefkowitz2018VirTax" class="csl-entry"
            role="doc-biblioentry">
            Lefkowitz, E. J. et al. 2018. <a
            href="https://doi.org/10.1093/nar/gkx932">Virus taxonomy:
            The database of the International Committee on Taxonomy of
            Viruses (ICTV)</a>. - Nucleic Acids Research 46: D708–D717.
            </div>
            <div id="ref-Melville2021RetApp" class="csl-entry"
            role="doc-biblioentry">
            Melville, J. et al. 2021. <a
            href="https://doi.org/10.1371/journal.pbio.3001210">A
            return-on-investment approach for prioritization of rigorous
            taxonomic research needed to inform responses to the
            biodiversity crisis</a>. - PLOS Biology 19: e3001210.
            </div>
            <div id="ref-Norman2020TaxHig" class="csl-entry"
            role="doc-biblioentry">
            Norman, K. E. A. et al. 2020. <a
            href="https://doi.org/10.1111/2041-210X.13440">Taxadb: A
            high-performance local taxonomic database interface</a>. -
            Methods in Ecology and Evolution 11: 1153–1159.
            </div>
            <div id="ref-Schoch2020NcbTax" class="csl-entry"
            role="doc-biblioentry">
            Schoch, C. L. et al. 2020. NCBI Taxonomy: A comprehensive
            update on curation, resources and tools. - Database in
            press.
            </div>
            <div id="ref-Shimatani2001MeaSpe" class="csl-entry"
            role="doc-biblioentry">
            Shimatani, K. 2001. <a
            href="https://www.jstor.org/stable/3547217">On the
            Measurement of Species Diversity Incorporating Species
            Differences</a>. - Oikos 93: 135–147.
            </div>
            <div id="ref-Wagner2016RevSof" class="csl-entry"
            role="doc-biblioentry">
            Wagner, V. 2016. A review of software tools for
            spell-checking taxon names in vegetation databases. -
            Journal of Vegetation Science 27: 1323–1327.
            </div>
            <div id="ref-Walker2020ChaVir" class="csl-entry"
            role="doc-biblioentry">
            Walker, P. J. et al. 2020. <a
            href="https://doi.org/10.1007/s00705-020-04752-x">Changes to
            virus taxonomy and the Statutes ratified by the
            International Committee on Taxonomy of Viruses (2020)</a>. -
            Archives of Virology 165: 2737–2748.
            </div>
            </div>
        </article>
    </main>

    <footer>
                <div class="container">
            <h2>Supplementary Material</h2>
            <span class="appendix--list">
                <a href="appendix/Poisot_et_al_2023_ncbitaxonomyjl__s1.pdf" target="_blank">
                    <b>1:</b>&nbsp;The metadata configuration file
                </a><br />
            </span><span class="appendix--list">
                <a href="appendix/Poisot_et_al_2023_ncbitaxonomyjl__s2.pdf" target="_blank">
                    <b>2:</b>&nbsp;Bibliography in supp. mat.
                </a><br />
            </span>
        </div>
                <div class="container">
            <h2>Affiliations</h2>
            <sup>1</sup>&nbsp;Université de Montréal, Départment de
            Sciences Biologiques, Montréal QC,
            Canada; <sup>10</sup>&nbsp;Center for Global Health Science
            and Security, Georgetown University Medical Center,
            Georgetown University, Washington, D.C., United States of
            America; <sup>2</sup>&nbsp;Québec Centre for Biodiversity
            Science, Montréal, QC, Canada; <sup>3</sup>&nbsp;Centre on
            Climate Change and Planetary Health, London School of
            Hygiene and Tropical Medicine, London,
            UK; <sup>4</sup>&nbsp;Centre for Mathematical Modelling of
            Infectious Diseases, London School of Hygiene and Tropical
            Medicine, London, UK; <sup>5</sup>&nbsp;Current address:
            Centre for Biodiversity and Environment Research, University
            College London, London, UK; <sup>6</sup>&nbsp;Emerging
            Pathogens Institute, University of Florida, Gainesville, FL,
            United States of America; <sup>7</sup>&nbsp;School of Life
            Sciences, University of KwaZulu-Natal, Durban, South
            Africa; <sup>8</sup>&nbsp;Department of Geography,
            University of Florida, Gainesville, FL, United States of
            America; <sup>9</sup>&nbsp;Department of Microbiology and
            Immunology, Georgetown University Medical Center, Georgetown
            University, Washington, D.C., United States of America
            <br />
            
        </div>
    </footer>

</body>

</html>