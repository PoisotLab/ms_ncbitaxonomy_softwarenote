%!TEX TS-program = xelatex
\documentclass[10pt,oneside]{article}
\usepackage[fontsize=9pt]{scrextend}

\usepackage[english]{babel}

\usepackage{amsmath,amssymb,amsfonts}
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage{stix2}
\usepackage[scaled]{helvet}
\usepackage[scaled]{inconsolata}

\usepackage{lastpage}

\usepackage{gensymb}

\usepackage{setspace}

\usepackage{ccicons}

\usepackage[hang,flushmargin]{footmisc}

\usepackage{geometry}

\setlength{\parindent}{0pt}
\setlength{\parskip}{6pt plus 2pt minus 1pt}

\usepackage{fancyhdr}
\renewcommand{\headrulewidth}{0pt}\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}

\makeatletter
\newcounter{tableno}
\newenvironment{tablenos:no-prefix-table-caption}{
  \caption@ifcompatibility{}{
    \let\oldthetable\thetable
    \let\oldtheHtable\theHtable
    \renewcommand{\thetable}{tableno:\thetableno}
    \renewcommand{\theHtable}{tableno:\thetableno}
    \stepcounter{tableno}
    \captionsetup{labelformat=empty}
  }
}{
  \caption@ifcompatibility{}{
    \captionsetup{labelformat=default}
    \let\thetable\oldthetable
    \let\theHtable\oldtheHtable
    \addtocounter{table}{-1}
  }
}
\makeatother

\usepackage{array}
\newcommand{\PreserveBackslash}[1]{\let\temp=\\#1\let\\=\temp}
\let\PBS=\PreserveBackslash

\usepackage[breaklinks=true]{hyperref}
\hypersetup{colorlinks,%
citecolor=blue,%
filecolor=blue,%
linkcolor=blue,%
urlcolor=blue}
\usepackage{url}

\usepackage{caption}
\setcounter{secnumdepth}{0}
\usepackage{cleveref}

\usepackage{graphicx}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth
\else\Gin@nat@width\fi}
\makeatother
\let\Oldincludegraphics\includegraphics
\renewcommand{\includegraphics}[1]{\Oldincludegraphics[width=\maxwidth]{#1}}

\usepackage{longtable}
\usepackage{booktabs}

\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{248,248,248}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\ImportTok}[1]{#1}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\BuiltInTok}[1]{#1}
\newcommand{\ExtensionTok}[1]{#1}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.77,0.63,0.00}{#1}}
\newcommand{\RegionMarkerTok}[1]{#1}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.94,0.16,0.16}{#1}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.64,0.00,0.00}{\textbf{#1}}}
\newcommand{\NormalTok}[1]{#1}

\newlength{\cslhangindent}
\setlength{\cslhangindent}{1.5em}
\newlength{\csllabelwidth}
\setlength{\csllabelwidth}{3em}
\newenvironment{CSLReferences}[2] % #1 hanging-ident, #2 entry spacing
 {% don't indent paragraphs
  \setlength{\parindent}{0pt}
  % turn on hanging indent if param 1 is 1
  \ifodd #1 \everypar{\setlength{\hangindent}{\cslhangindent}}\ignorespaces\fi
  % set entry spacing
  \ifnum #2 > 0
  \setlength{\parskip}{#2\baselineskip}
  \fi
 }%
 {}
\usepackage{calc} % for \widthof, \maxof
\newcommand{\CSLBlock}[1]{#1\hfill\break}
\newcommand{\CSLLeftMargin}[1]{\parbox[t]{\maxof{\widthof{#1}}{\csllabelwidth}}{#1}}
\newcommand{\CSLRightInline}[1]{\parbox[t]{\linewidth}{#1}}
\newcommand{\CSLIndent}[1]{\hspace{\cslhangindent}#1}\usepackage[table,dvipsnames]{xcolor}

\geometry{includemp,
            letterpaper,
            top=2.4cm,
            bottom=2.4cm,
            left=1.0cm,
            right=1.0cm,
            marginparwidth=5cm,
            marginparsep=1.0cm}

\usepackage[singlelinecheck=off]{caption}

\captionsetup{
  font={small},
  labelfont={bf},
  format=plain,
  labelsep=quad
}

\usepackage{floatrow}

\floatsetup[figure]{margins=hangright,
              facing=no,
              capposition=beside,
              capbesideposition={center,outside},
              floatwidth=\textwidth}

% \floatsetup[table]{margins=hangright,
%              facing=no,
%              capposition=beside,
%              capbesideposition={center,outside},
%              floatwidth=\textwidth}

\pagestyle{plain}

\setcounter{secnumdepth}{5}

\usepackage{titlesec}

\titleformat{\section}[block]
{\normalfont\large\sffamily}
{\thesection}{.5em}{\titlerule\\[.8ex]\bfseries}

\titleformat{\subsection}[runin]
{\normalfont\fontseries{b}\selectfont\filright\sffamily}
{\thesubsection.}{.5em}{}

\titleformat{\subsubsection}[runin]
{\normalfont\itshape\rmfamily\bfseries}{\thesubsubsection}{1em}{}

\fancypagestyle{firstpage}
{
   \fancyhf{}
   \renewcommand{\headrulewidth}{0pt}
   \fancyfoot[R]{\footnotesize\ccby}
   \fancyfoot[L]{\footnotesize\sffamily\today}
}

\fancypagestyle{normal}
{
  \fancyhf{}
  \fancyfoot[R]{\footnotesize\sffamily\thepage\ of \pageref*{LastPage}}
}

\usepackage{tikz}
\begin{document}
\tikz [remember picture, overlay] %
\node [shift={(-0.6in,1.1cm)},scale=0.2,opacity=0.4] at (current page.south east)[anchor=south east]{\includegraphics{logo}};%
\pagestyle{normal}
\thispagestyle{firstpage}

\newcommand{\colorRule}[3][black]{\textcolor[HTML]{#1}{\rule{#2}{#3}}}

\noindent {\LARGE \textbf{\textsf{NCBITaxonomy.jl - rapid biological
names finding and reconciliation}}}

\medskip
\begin{flushleft}
{\small
%
\href{https://orcid.org/0000-0002-0735-5184}{Timothée\,Poisot}%
%
\,\textsuperscript{1,2}, %
\href{https://orcid.org/0000-0002-0965-1649}{Rory\,Gibb}%
%
\,\textsuperscript{3,4,5}, %
\href{https://orcid.org/0000-0002-4308-6321}{Sadie J.\,Ryan}%
%
\,\textsuperscript{6,7,8}, %
\href{https://orcid.org/0000-0001-6960-8434}{Colin J.\,Carlson}%
%
\,\textsuperscript{10,9}
\vskip 1em
\textsuperscript{1}\,Université de Montréal, Départment de Sciences
Biologiques, Montréal QC, Canada; \textsuperscript{10}\,Center for
Global Health Science and Security, Georgetown University Medical
Center, Georgetown University, Washington, D.C., United States of
America; \textsuperscript{2}\,Québec Centre for Biodiversity Science,
Montréal, QC, Canada; \textsuperscript{3}\,Centre on Climate Change and
Planetary Health, London School of Hygiene and Tropical Medicine,
London, UK; \textsuperscript{4}\,Centre for Mathematical Modelling of
Infectious Diseases, London School of Hygiene and Tropical Medicine,
London, UK; \textsuperscript{5}\,Current address: Centre for
Biodiversity and Environment Research, University College London,
London, UK; \textsuperscript{6}\,Emerging Pathogens Institute,
University of Florida, Gainesville, FL, United States of
America; \textsuperscript{7}\,School of Life Sciences, University of
KwaZulu-Natal, Durban, South Africa; \textsuperscript{8}\,Department of
Geography, University of Florida, Gainesville, FL, United States of
America; \textsuperscript{9}\,Department of Microbiology and Immunology,
Georgetown University Medical Center, Georgetown University, Washington,
D.C., United States of America\\
\vskip 1em
\textbf{Correspondance to:}\\
Timothée Poisot --- \texttt{timothee.poisot@umontreal.ca}\\
}
\end{flushleft}

\vskip 2em
\makebox[0pt][l]{\colorRule[CCCCCC]{2.0\textwidth}{0.5pt}}
\vskip 2em
\noindent

\marginpar{\vskip 1em\flushright
{\small{\bfseries Keywords}:\par
biodiversity\\taxonomy\\NCBI\\fuzzy matching\\}
}


\texttt{NCBITaxonomy.jl} is a package designed to facilitate the
reconciliation and cleaning of taxonomic names, using a local copy of
the NCBI taxonomic backbone (Federhen 2012, Schoch et al. 2020); The
basic search functions are coupled with quality-of-life functions
including case-insensitive search and custom fuzzy string matching to
facilitate the amount of information that can be extracted automatically
while allowing efficient manual curation and inspection of results.
\texttt{NCBITaxonomy.jl} works with version 1.6 of the Julia programming
language (Bezanson et al. 2017), and relies on the Apache Arrow format
to store a local copy of the NCBI raw taxonomy files. The design of
\texttt{NCBITaxonomy.jl} has been inspired by similar efforts, like the
R package \texttt{taxadb} (Norman et al. 2020), which provides an
offline alternative to packages like \texttt{taxize} (Chamberlain and
Szöcs 2013).




\vskip 2em
\makebox[0pt][l]{\colorRule[CCCCCC]{2.0\textwidth}{0.5pt}}
\vskip 2em

Unambiguously identifying species is a far more challenging task than it
may appear. There are a vast number of reasons for this. Different
databases keep different taxonomic ``backbones'', \emph{i.e.} different
data structures in which names are mapped to species, and organised in a
hierarchy. Not all names are unique identifiers to groups. For example,
\emph{Io} can either refer to a genus of plants from the aster family,
or to a genus of molluscs; the genus \emph{Mus} (of which the house
mouse \emph{Mus musculus} is a species), contains a sub-genus
\emph{also} named \emph{Mus} (within which \emph{Mus musculus} is
located). Conversely, the same species can have several names, which are
valid synonyms: for example, the domestic cow \emph{Bos taurus} admits
\emph{Bos primigenius taurus} as a valid synonym. In addition to
binomial names, the same species can be known by many vernacular
(common) names, which are language or even region-specific: \emph{Ovis
aries}, for example, has valid English vernaculars including lamb,
sheep, wild sheep, and domestic sheep.

Finally, taxonomic nomenclature changes regularly, with groups being
split, merged, or moved to a new position in the tree of life; this is,
notably, a common occurrence with viral taxonomy, each subsequent
version of which can differ markedly from the last; compare, \emph{e.g}
Lefkowitz et al. (2018) to Walker et al. (2020), where entire viral
sub-trees were split, re-organized, and created within just two years.
These taxonomic changes have profound implications for the way we
perceive biodiversity at global scales (Dikow et al. 2009), to the point
were taxonomic revisions should sometimes be actively conducted to
improve \emph{e.g.} conservation outcomes (Melville et al. 2021).

To add to the complexity, one must also consider that most taxa names
are at some point manually typed, which has the potential to introduce
additional mistakes in raw data; it is likely to expect that such
mistakes may arise when attempting to write down the (perfectly valid)
names of the bacterial isolate known as \emph{Myxococcus
llanfairpwllgwyngyllgogerychwyrndrobwllllantysiliogogogochensis}, or of
the crowned slaty flycatcher \emph{Griseotyrannus
aurantioatrocristatus}. These mistakes are more likely when dealing with
hyper-diverse samples (demanding to memorize more names), like plant
census (Dauncey et al. 2016, Wagner 2016, Conti et al. 2021); when
dealing with multiple investigators with different knowledge of the
taxonomy; and as a result of the estimated error in any data entry
exercice, which other fields estimate at up to about 5\% (Barchard and
Pace 2011).

All these considerations become important when matching species names
both within and across datasets. Let us consider the hypothetical
species survey of riverine fishes: European chub, \emph{Cyprinus
cephalus}, \emph{Leuciscus cephalus}, \emph{Squalius cephalus}. All are
the same species (\emph{S. cephalus}), referred to as one of the
vernacular (European chub) and two formerly accepted names now
classified as synonyms (but still present in the litterature). A
cautious estimate of diversity based on the user-supplied names would
give \(n=4\) species, when there is in fact only one. When the size of
biodiversity datasets increases, and notably when the taxonomic scope of
these datasets explodes, including organisms for which ``names'' are a
fuzzier concept (for example, \emph{Influenza A virus
(A/Sydney/05/97-like(H3N2))} is a valid name for a common influenza
strain, although one that lacks a taxonomic rank), the feasibility of
manual curation decreases.

In this manuscript, we describe \texttt{NCBITaxonomy.jl}, a Julia
package that provides advanced name matching and error handling
capacities for the reconciliation of taxonomic names to the NCBI
database. This package was used to facilitate the development of the
\emph{CLOVER} (Gibb et al. 2021) database of host-virus associations, by
reconciling the names of viruses and mammals from four different
sources, where all of the issues described above were present. More
recently, it has become part of the automated curation of data for the
\emph{VIRION} (Carlson et al. 2022) database, which automatically
curates an up-to-date, authoritative virome network from dozens of
heterogeneous sources. We describe the core capacities of this package,
and highlight how it enables safe, high-performance name reconciliation.

\hypertarget{overview-of-functionalities}{%
\section{Overview of
functionalities}\label{overview-of-functionalities}}

An up-to-date version of the documentation for \texttt{NCBITaxonomy.jl}
can be found online from the EcoJulia documentation hub
\href{https://docs.ecojulia.org/NCBITaxonomy.jl/stable/}{https://docs.ecojulia.org/},
including examples and in-line documentation of every method. The
package is released under the MIT license. Contributions can be made in
the form of issues (bug reports, questions, features suggestions) and
pull requests.

In order to achieve good performance, the package will first retrieve
the latest (as validated by its checksum) NCBI taxonomy backbone, store
it locally, and pre-process it as a set of Julia data tables. By
default, the taxonomy will be downloaded to the Julia package
repository, which is not an ideal solution, and therefore we recommend
that users set an environment variable to specificy where the data will
be loaded from (this path will be created if it doesn't exist):

\begin{Shaded}
\begin{Highlighting}[]
\ConstantTok{ENV}\NormalTok{[}\StringTok{"NCBITAXONOMY\_PATH"}\NormalTok{] }\OperatorTok{=} \FunctionTok{joinpath}\NormalTok{(}\FunctionTok{homedir}\NormalTok{(), }\StringTok{"data"}\NormalTok{, }\StringTok{"NCBITaxonomy.jl"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Note that this location can be different for different projects, as the
package is able to update the taxoonmic backbone (and will indeed prompt
the user to do so if the taxonomy is more than 90 days old). The package
can then be checked out and installed anonymously from the central Julia
repository:

\begin{Shaded}
\begin{Highlighting}[]
\ImportTok{using} \BuiltInTok{Pkg}
\BuiltInTok{Pkg}\NormalTok{.}\FunctionTok{add}\NormalTok{(}\StringTok{"NCBITaxonomy"}\NormalTok{) }\CommentTok{\# Dowloading the files may take a long time}
\end{Highlighting}
\end{Shaded}

As long as the package is not re-built, the local set of tables
downloaded from NCBI will not change; this way, users can re-run an
analysis with a guarantee that the underlying taxonomic backbone has not
changed, which is not the case when relying on API queries. In order to
update the taxonomic backbone, users can call the \texttt{build}
function of Julia's package manager (\texttt{{]}build\ NCBITaxonomy}),
which will download the most recent version of all files.

This software note describes version \texttt{v0.2.3} of the package (we
follow semantic versioning), which works on Julia 1.5 upwards. The
dependencies are all resolved by the package manager at installation,
and (on the user-facing side) include the \texttt{StringDistances.jl}
package, allowing users to experiment with different string matching
methods. As is best practices for Julia packages, a
\texttt{Project.toml} file specifying compatible dependencies versions
is distributed with the package. The code is covered by unit-tests (with
about 98\% coverage), as well as integration tests as part of the
documentation (specifically, a use-case detailing how to clean data from
a biodiversity survey, and a use-case aiming to reconstruct a taxonomic
tree for the Lemuriformes).

\hypertarget{improved-name-matching}{%
\subsection{Improved name matching}\label{improved-name-matching}}

Name finding, \emph{i.e.} the matching of an arbitrary string to a
taxonomic identifier, is primarily done through the \texttt{taxon}
function, which admits either a unique NCBI identifier (\emph{e.g.}
\texttt{taxon(36219)} for the bogue \emph{Boops boops}), a string
(\texttt{taxon("Boops\ boops")}), or a data frame with a restricted list
of names in order to create a name finder function (see the next
section). The \texttt{taxon} method has additional arguments to perform
fuzzy matching in order to catch possible typos
(\texttt{taxon("Boops\ bops";\ strict=false)}), to perform a lowercase
search (useful when alphanumeric codes are part of the taxon name, like
for some viruses), and to restrict the the search to a specific
taxonomic rank. The \texttt{taxon} function also accepts a
\texttt{preferscientificname} keyword, to prevent matching vernacular
names; the use of this keyword ought to be informed by knowledge about
how the data were entered.

The lowercase search can be a preferable alternative to fuzzy string
matching. Consider the string \texttt{Adeno-associated\ virus\ 3b} - it
has three names with equal distance (under the Levensthein string
distance function):

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{julia}\OperatorTok{\textgreater{}} \FunctionTok{similarnames}\NormalTok{(}\StringTok{"Adeno{-}associated virus 3b"}\NormalTok{; threshold}\OperatorTok{=}\FloatTok{0.95}\NormalTok{)}
\FloatTok{3}\OperatorTok{{-}}\NormalTok{element }\DataTypeTok{Vector}\NormalTok{\{}\DataTypeTok{Pair}\NormalTok{\{NCBITaxon, }\DataTypeTok{Float64}\NormalTok{\}\}}\OperatorTok{:}
\NormalTok{  Adeno}\OperatorTok{{-}}\NormalTok{associated virus }\OperatorTok{{-}} \FloatTok{3}\NormalTok{ (ncbi}\OperatorTok{:}\FloatTok{46350}\NormalTok{) }\OperatorTok{=\textgreater{}} \FloatTok{0.96}
\NormalTok{   Adeno}\OperatorTok{{-}}\NormalTok{associated virus }\FloatTok{3}\NormalTok{B (ncbi}\OperatorTok{:}\FloatTok{68742}\NormalTok{) }\OperatorTok{=\textgreater{}} \FloatTok{0.96}
\NormalTok{ Adeno}\OperatorTok{{-}}\NormalTok{associated virus }\FloatTok{3}\NormalTok{A (ncbi}\OperatorTok{:}\FloatTok{1406223}\NormalTok{) }\OperatorTok{=\textgreater{}} \FloatTok{0.96}
\end{Highlighting}
\end{Shaded}

Depending on the operating system (and specifically whether it is
case-sensitive), either of these three names can be returned; compare to
the output of a case insensitive name search:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{julia}\OperatorTok{\textgreater{}} \FunctionTok{taxon}\NormalTok{(}\StringTok{"Adeno{-}associated virus 3b"}\NormalTok{; casesensitive}\OperatorTok{=}\ConstantTok{false}\NormalTok{)}
\NormalTok{Adeno}\OperatorTok{{-}}\NormalTok{associated virus }\FloatTok{3}\NormalTok{B (ncbi}\OperatorTok{:}\FloatTok{68742}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

This returns the correct name.

\hypertarget{name-matching-output-and-error-handling}{%
\subsection{Name matching output and error
handling}\label{name-matching-output-and-error-handling}}

When it succeeds, \texttt{taxon} will return a \texttt{NCBITaxon} object
(made of a \texttt{name} string field, and an \texttt{id} numerical
field). That being said, the package is designed under the assumption
that ambiguities should yield an error for the user to handle. There are
two such errors: \texttt{NameHasNoDirectMatch} (with instructions about
how to possible solve it, using the \texttt{similarnames} function), or
a \texttt{NameHasMultipleMatches} (listing the possible valid matches,
and suggesting to use \texttt{alternativetaxa} to find the correct one).
Therefore, the common way to work with the \texttt{taxon} function would
be to wrap it in a \texttt{try}/\texttt{catch} statement:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{try}
  \FunctionTok{taxon}\NormalTok{(name)}
  \CommentTok{\# Additional operations with the matched name}
\NormalTok{catch err}
  \ControlFlowTok{if} \FunctionTok{isa}\NormalTok{(err, NameHasNoDirectMatch)}
    \CommentTok{\# What to do if no match is found}
  \ControlFlowTok{elseif} \FunctionTok{isa}\NormalTok{(err, NameHasMultipleMatches)}
    \CommentTok{\# What to do if there are multiple matches}
  \ControlFlowTok{else}
    \CommentTok{\# What to do in case of another error that is not NCBITaxonomy specific}
  \ControlFlowTok{end}
\KeywordTok{end}
\end{Highlighting}
\end{Shaded}

These functions will not demand any user input in the form of key
presses (though they can be wrapped in additional code to allow it), as
they are intended to run on clusters or virtual machines without
supervision. The \texttt{taxon} function has good scaling using muliple
threads. For convenience in rapidly getting a taxon for demonstration
purposes, we also provide a string macro, whereby \emph{e.g.}
\texttt{ncbi"Procyon\ lotor"} will return the taxon object for the
raccoon.

\hypertarget{name-filtering-functions}{%
\subsection{Name filtering functions}\label{name-filtering-functions}}

As the full NCBI names table has over 3 million entries at the time of
writing, we have provided a number of functions to restrict the scope of
names that are searched. These are driven by the NCBI \emph{divisions}.
For example \texttt{nf\ =\ mammalfilter(true)} will return a data frame
containing the names of mammals, inclusive of rodents and primates, and
can be used with \emph{e.g.} \texttt{taxon(nf,\ "Pan")}. This has the
dual advantage of making search faster, but also of avoiding matching on
names that are shared by another taxonomic group (which is not an issue
with \emph{Pan}, but is an issue with \emph{e.g.} \emph{Io} as mentioned
in the introduction, or with the common name \emph{Lizard}, which
fuzzy-matches on the hemipteran genus \emph{Lisarda} rather than the
class \emph{Lepidosauria}).

Note that the use of a restricted list of names can have significant
performance consequences: compare, for example, the time taken to return
the taxon \emph{Pan} in the entire database, in all mammals, and in all
primates:

\begin{longtable}[]{@{}
  >{\raggedright\arraybackslash}p{(\columnwidth - 8\tabcolsep) * \real{0.2857}}
  >{\centering\arraybackslash}p{(\columnwidth - 8\tabcolsep) * \real{0.2000}}
  >{\raggedright\arraybackslash}p{(\columnwidth - 8\tabcolsep) * \real{0.1286}}
  >{\raggedright\arraybackslash}p{(\columnwidth - 8\tabcolsep) * \real{0.1571}}
  >{\raggedright\arraybackslash}p{(\columnwidth - 8\tabcolsep) * \real{0.2286}}@{}}
\toprule()
\begin{minipage}[b]{\linewidth}\raggedright
Names list
\end{minipage} & \begin{minipage}[b]{\linewidth}\centering
Fuzzy matching
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedright
Time (ms)
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedright
Allocations
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedright
Memory allocated
\end{minipage} \\
\midrule()
\endhead
all & no & 23 & 34 & 2 KiB \\
& yes & 105 & 2580 & 25 MiB \\
\texttt{mammalfilter(true)} & no & 0.55 & 32 & 2 KiB \\
& yes & 1.9 & 551 & 286 KiB \\
\texttt{primatefilter()} & no & 0.15 & 33 & 2 KiB \\
& yes & 0.3 & 92 & 27 KiB \\
\bottomrule()
\end{longtable}

Clearly, the optimal search strategy is to (i) rely on name filters to
ensure that search are conducted within the appropriate NCBI division,
and (ii) only rely on fuzzy matching when the strict or lowercase match
fails to return a name, as fuzzy matching can result in order of
magnitude more run time and memory footprint. These numbers were
obtained on a single Intel i7-8665U CPU (@ (1.90GHz). Using
\texttt{"chimpanzees"} as the search string (one of the NCBI recognized
vernaculars for \emph{Pan}) gave qualitatively similar results,
suggesting that there is no performance cost associated with working
with synonyms or verncular input data.

\hypertarget{quality-of-life-functions}{%
\subsection{Quality of life functions}\label{quality-of-life-functions}}

In order to facilitate working with names, we provide the
\texttt{authority} function (gives the full taxonomic authority for a
name), \texttt{synonyms} (to get alternative valid names),
\texttt{vernacular} (for English common names), and \texttt{rank} (for
the taxonomic rank). These functions are not used in name matching, but
are often useful in the post-processing of results.

\hypertarget{taxonomic-lineages-navigation}{%
\subsection{Taxonomic lineages
navigation}\label{taxonomic-lineages-navigation}}

The \texttt{children} function will return all nodes that are directly
descended from a taxon; the \texttt{descendants} function will
recursively apply this function to all descendants of these nodes, until
only terminal leaves are reached. The \texttt{parent} function is an
``upwards'' equivalent, giving the taxon from which a taxon descends;
the \texttt{lineage} function chains calls to \texttt{parent} until
either \texttt{taxon(1)} (the taxonomy root) or an arbitrary ancestor is
reached.

The \texttt{taxonomicdistance} function (and its in-place equivalent,
\texttt{taxonomicdistance!}, which uses memory-efficient re-allocation
if the user needs to change the distance between taxonomic ranks) uses
the Shimatani (2001) approach to reconstruct a matrix of distances based
on taxonomy, which can serve as a rough proxy when no phylogenies are
available. This allows coarse estimations of taxonomic diversity based
on species lists. The default distance between taxoonmic levels is as in
Shimatani (2001) (\emph{i.e.} species have a distance of 0, genus of 1,
family of 2, sbu-classes of 3, and everything else 4), but specific
scores can be passed for \emph{any} taxonomic level know to the NCBI
name table.

\hypertarget{conclusion}{%
\section{Conclusion}\label{conclusion}}

\texttt{NCBITaxonomy.jl} enables rapid, taxonomically-restricted,
adaptive matching for taxonomic names. By implementing various
combinations of search strategies, it allows users to (i) optimize the
speed of their queries and (ii) avoid usual caveats of simple string
matching. Through explicit exceptions, it allows to write code that will
handle the possible edge cases that cannot be solved automatically in a
way that does not interrupt execution, or requires manual input by the
user. Given the breadth of the NCBI taxonomy database,
\texttt{NCBITaxonomy.jl} is particularly suited to the name cleaning of
large datasets of names.

\textbf{Acknowledgements:} This work was supported by funding to the
Viral Emergence Research Initiative (VERENA) consortium including NSF
BII 2021909 and 2213854 and a grant from Institut de Valorisation des
Données (IVADO), by the NSERC Discovery Grants and Discovery
Acceleration Supplement programs, and by a donation from the Courtois
Foundation. Benchmarking of this package on distributed systems was
enabled by support provided by Calcul Québec
(\texttt{www.calculquebec.ca}) and Compute Canada
(\texttt{www.computecanada.ca}). TP wrote the initial code, TP and CJC
contributed to API design, and all authors contributed to
functionalities and usability testing.

\hypertarget{references}{%
\section*{References}\label{references}}
\addcontentsline{toc}{section}{References}

\hypertarget{refs}{}
\begin{CSLReferences}{1}{0}
\leavevmode\vadjust pre{\hypertarget{ref-Barchard2011PreHum}{}}%
Barchard, K. and Pace, L. 2011.
\href{https://doi.org/10.1016/j.chb.2011.04.004}{Preventing human error:
The impact of data entry methods on data accuracy and statistical
results}. - Computers in Human Behavior 27: 1834--1839.

\leavevmode\vadjust pre{\hypertarget{ref-Bezanson2017JulFre}{}}%
Bezanson, J. et al. 2017.
\href{https://doi.org/10.1137/141000671}{Julia: A Fresh Approach to
Numerical Computing}. - SIAM Review 59: 65--98.

\leavevmode\vadjust pre{\hypertarget{ref-Carlson2022GloVir}{}}%
Carlson, C. J. et al. 2022.
\href{https://doi.org/10.1128/mbio.02985-21}{The Global Virome in One
Network (VIRION): An Atlas of Vertebrate-Virus Associations}. - mBio in
press.

\leavevmode\vadjust pre{\hypertarget{ref-Chamberlain2013TaxTax}{}}%
Chamberlain, S. A. and Szöcs, E. 2013.
\href{https://doi.org/10.12688/f1000research.2-191.v2}{Taxize: Taxonomic
search and retrieval in R}. - F1000Research 2: 191.

\leavevmode\vadjust pre{\hypertarget{ref-Conti2021MatAlg}{}}%
Conti, M. et al. 2021. Match Algorithms for Scientific Names in
FlorItaly, the Portal to the Flora of Italy. - Plants 10: 974.

\leavevmode\vadjust pre{\hypertarget{ref-Dauncey2016ComMis}{}}%
Dauncey, E. A. et al. 2016. Common mistakes when using plant names and
how to avoid them. - European Journal of Integrative Medicine 8:
597--601.

\leavevmode\vadjust pre{\hypertarget{ref-Dikow2009BioRes}{}}%
Dikow, T. et al. 2009. Biodiversity Research Based on Taxonomic
Revisions - A Tale of Unrealized Opportunities. - In: Diptera Diversity:
Status, Challenges and Tools. Brill, pp. 323--346.

\leavevmode\vadjust pre{\hypertarget{ref-Federhen2012NcbTax}{}}%
Federhen, S. 2012. The NCBI taxonomy database. - Nucleic acids research
40: D136--D143.

\leavevmode\vadjust pre{\hypertarget{ref-Gibb2021DatPro}{}}%
Gibb, R. et al. 2021. \href{https://doi.org/10.1093/biosci/biab080}{Data
Proliferation, Reconciliation, and Synthesis in Viral Ecology}. -
BioScience in press.

\leavevmode\vadjust pre{\hypertarget{ref-Lefkowitz2018VirTax}{}}%
Lefkowitz, E. J. et al. 2018.
\href{https://doi.org/10.1093/nar/gkx932}{Virus taxonomy: The database
of the International Committee on Taxonomy of Viruses (ICTV)}. - Nucleic
Acids Research 46: D708--D717.

\leavevmode\vadjust pre{\hypertarget{ref-Melville2021RetApp}{}}%
Melville, J. et al. 2021.
\href{https://doi.org/10.1371/journal.pbio.3001210}{A
return-on-investment approach for prioritization of rigorous taxonomic
research needed to inform responses to the biodiversity crisis}. - PLOS
Biology 19: e3001210.

\leavevmode\vadjust pre{\hypertarget{ref-Norman2020TaxHig}{}}%
Norman, K. E. A. et al. 2020.
\href{https://doi.org/10.1111/2041-210X.13440}{Taxadb: A
high-performance local taxonomic database interface}. - Methods in
Ecology and Evolution 11: 1153--1159.

\leavevmode\vadjust pre{\hypertarget{ref-Schoch2020NcbTax}{}}%
Schoch, C. L. et al. 2020. NCBI Taxonomy: A comprehensive update on
curation, resources and tools. - Database in press.

\leavevmode\vadjust pre{\hypertarget{ref-Shimatani2001MeaSpe}{}}%
Shimatani, K. 2001. \href{https://www.jstor.org/stable/3547217}{On the
Measurement of Species Diversity Incorporating Species Differences}. -
Oikos 93: 135--147.

\leavevmode\vadjust pre{\hypertarget{ref-Wagner2016RevSof}{}}%
Wagner, V. 2016. A review of software tools for spell-checking taxon
names in vegetation databases. - Journal of Vegetation Science 27:
1323--1327.

\leavevmode\vadjust pre{\hypertarget{ref-Walker2020ChaVir}{}}%
Walker, P. J. et al. 2020.
\href{https://doi.org/10.1007/s00705-020-04752-x}{Changes to virus
taxonomy and the Statutes ratified by the International Committee on
Taxonomy of Viruses (2020)}. - Archives of Virology 165: 2737--2748.

\end{CSLReferences}

\end{document}
